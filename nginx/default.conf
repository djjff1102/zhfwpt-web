server {
  listen       80;
  server_name  localhost;
  add_header X-Frame-Options SAMEORIGIN;

  #charset koi8-r;
  access_log  /var/log/nginx/host.access.log  main;
  error_log  /var/log/nginx/error.log  error;
  client_max_body_size 2000M;
  client_body_buffer_size 2000M;
  location / {
      root   /opt/td_xy_web;
      index  index.html index.htm;
  }

  #error_page  404              /404.html;
  
  # redirect server error pages to the static page /50x.html
  #
  # 
  error_page   500 502 503 504  /50x.html;
  location = /50x.html {
      root   /usr/share/nginx/html;
  }
  
  location /prod-api {
    rewrite ^/prod-api/(.*) /$1 break;
    proxy_pass http://gateway:8080;
    tcp_nodelay     on;
    proxy_set_header Host            $host;
    proxy_set_header X-Real-IP       $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_read_timeout 300;
    client_max_body_size 100M;
  }
  location /check_consistency {
    proxy_pass http://192.168.0.158:5031;
    tcp_nodelay     on;
    proxy_set_header Host            $host;
    proxy_set_header X-Real-IP       $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_read_timeout 300;
    client_max_body_size 100M;
  }
  location /process_documents {
    proxy_pass http://192.168.0.158:5032;
    tcp_nodelay     on;
    proxy_set_header Host            $host;
    proxy_set_header X-Real-IP       $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_read_timeout 300;
    client_max_body_size 100M;
  }
  location /risk_pre {
    proxy_pass http://192.168.0.158:5033;
    tcp_nodelay     on;
    proxy_set_header Host            $host;
    proxy_set_header X-Real-IP       $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_read_timeout 300;
    client_max_body_size 100M;
  }
}
